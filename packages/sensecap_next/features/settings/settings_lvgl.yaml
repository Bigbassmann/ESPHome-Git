lvgl:
  pages:
    - id: page_settings
      widgets:
        - label:
            id: settings_title
            text: "Settings"
            align: TOP_MID
            y: 22
            text_font: montserrat_32
            text_color: 0x1D4ED8

        - label:
            id: brightness_label
            text: "Brightness"
            align: TOP_LEFT
            x: 20
            y: 106
            text_font: montserrat_20
            text_color: 0xFFFFFF

        - slider:
            id: brightness_slider
            align: TOP_LEFT
            x: 170
            y: 112
            width: 230
            height: 18
            min_value: 0
            max_value: 100
            bg_color: 0x374151
            knob:
              bg_color: 0xFFFFFF
              border_color: 0x4F46E5
              border_width: 2
            indicator:
              bg_color: 0x4F46E5
            on_value:
              then:
                - lambda: |-
                    id(display_brightness_pct) = x;
                    id(last_interaction_ms) = millis();
                    id(last_auto_scroll_ms) = id(last_interaction_ms);
                - light.control:
                    id: backlight
                    state: ON
                    brightness: !lambda |-
                      if (id(display_brightness_pct) <= 0) return 0.0f;
                      return id(display_brightness_pct) / 100.0f;

        - label:
            id: brightness_value
            text: "50%"
            align: TOP_LEFT
            x: 412
            y: 106
            text_font: montserrat_18
            text_color: 0xC0C0C0

        - label:
            id: idle_scroll_title
            text: "Idle Scroll"
            align: TOP_LEFT
            x: 20
            y: 176
            text_font: montserrat_20
            text_color: 0xFFFFFF

        - button:
            id: idle_scroll_enable_btn
            align: TOP_LEFT
            x: 130
            y: 172
            width: 120
            height: 36
            bg_color: 0x374151
            radius: 8
            border_width: 0
            on_press:
              then:
                - lambda: |-
                    id(display_idle_scroll_enabled) = !id(display_idle_scroll_enabled);
                    if (id(display_idle_scroll_enabled)) id(display_sleep_enabled) = false;
                    id(last_interaction_ms) = millis();
                    id(last_auto_scroll_ms) = id(last_interaction_ms);
            widgets:
              - label:
                  text: "Auto"
                  align: LEFT_MID
                  x: 10
                  text_font: montserrat_16
                  text_color: 0xFFFFFF
              - label:
                  id: idle_scroll_enable_state
                  text: "OFF"
                  align: RIGHT_MID
                  x: -10
                  text_font: montserrat_16
                  text_color: 0xFCA5A5

        - label:
            id: idle_scroll_timeout_label
            text: "Delay"
            align: TOP_LEFT
            x: 262
            y: 176
            text_font: montserrat_18
            text_color: 0xFFFFFF

        - slider:
            id: idle_scroll_timeout_slider
            align: TOP_LEFT
            x: 310
            y: 182
            width: 90
            height: 18
            min_value: 15
            max_value: 300
            bg_color: 0x374151
            knob:
              bg_color: 0xFFFFFF
              border_color: 0x0EA5E9
              border_width: 2
            indicator:
              bg_color: 0x0EA5E9
            on_value:
              then:
                - lambda: |-
                    id(display_idle_scroll_s) = x;
                    id(last_interaction_ms) = millis();
                    id(last_auto_scroll_ms) = id(last_interaction_ms);

        - label:
            id: idle_scroll_timeout_value
            text: "30s"
            align: TOP_LEFT
            x: 412
            y: 176
            text_font: montserrat_18
            text_color: 0xC0C0C0

        - label:
            id: sleep_title
            text: "Display Sleep"
            align: TOP_LEFT
            x: 20
            y: 246
            text_font: montserrat_20
            text_color: 0xFFFFFF

        - button:
            id: sleep_enable_btn
            align: TOP_LEFT
            x: 130
            y: 242
            width: 120
            height: 36
            bg_color: 0x374151
            radius: 8
            border_width: 0
            on_press:
              then:
                - lambda: |-
                    id(display_sleep_enabled) = !id(display_sleep_enabled);
                    if (id(display_sleep_enabled)) id(display_idle_scroll_enabled) = false;
                    id(last_interaction_ms) = millis();
                    id(last_auto_scroll_ms) = id(last_interaction_ms);
                - if:
                    condition:
                      lambda: 'return !id(display_sleep_enabled) && id(screen_off);'
                    then:
                      - lvgl.resume:
                      - script.execute: apply_display_brightness
                      - lambda: 'id(screen_off) = false;'
            widgets:
              - label:
                  text: "Sleep"
                  align: LEFT_MID
                  x: 10
                  text_font: montserrat_16
                  text_color: 0xFFFFFF
              - label:
                  id: sleep_enable_state
                  text: "ON"
                  align: RIGHT_MID
                  x: -10
                  text_font: montserrat_16
                  text_color: 0xD1FAE5

        - label:
            id: sleep_timeout_label
            text: "Timeout"
            align: TOP_LEFT
            x: 262
            y: 246
            text_font: montserrat_18
            text_color: 0xFFFFFF

        - slider:
            id: sleep_timeout_slider
            align: TOP_LEFT
            x: 326
            y: 252
            width: 74
            height: 18
            min_value: 15
            max_value: 300
            bg_color: 0x374151
            knob:
              bg_color: 0xFFFFFF
              border_color: 0x2563EB
              border_width: 2
            indicator:
              bg_color: 0x2563EB
            on_value:
              then:
                - lambda: |-
                    id(display_sleep_timeout_s) = x;
                    id(last_interaction_ms) = millis();
                    id(last_auto_scroll_ms) = id(last_interaction_ms);

        - label:
            id: sleep_timeout_value
            text: "60s"
            align: TOP_LEFT
            x: 412
            y: 246
            text_font: montserrat_18
            text_color: 0xC0C0C0
